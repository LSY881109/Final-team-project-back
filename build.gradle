buildscript {
    ext {
        // Querydsl ë²„ì „ ìœ ì§€ (Jakarta EE í˜¸í™˜ ë²„ì „)
        queryDslVersion = "5.0.0"
    }
}

plugins {
    id 'java'
    // Spring Boot ë²„ì „: ìš”ì²­í•˜ì‹  3.5.4 ì ìš©
    id 'org.springframework.boot' version '3.5.4'
    id 'io.spring.dependency-management' version '1.1.7'
}

group = 'com.busanit501'
version = '0.0.1-SNAPSHOT'
description = 'API_REST_TEST_JWT_REACT'

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)
    }
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()  // Public repository
    google()        // Public repository
    maven {        // Custom repository
        url = uri("https://oss.sonatype.org/content/repositories/releases/")
    }
    mavenLocal()   // Local repository
    flatDir {      // File location
        dirs "libs"
    }
}

dependencies {
    // ----------------------------------------------------
    // Core & Persistence (ê¸°ë³¸)
    // ----------------------------------------------------
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-web'
    // Validation ìŠ¤íƒ€í„° ì¶”ê°€
    implementation 'org.springframework.boot:spring-boot-starter-validation'

    // Security & JWT
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'io.jsonwebtoken:jjwt-api:0.11.5'
    runtimeOnly 'io.jsonwebtoken:jjwt-impl:0.11.5'
    runtimeOnly 'io.jsonwebtoken:jjwt-jackson:0.11.5'

    // Database (MariaDB, MongoDB)
    // ğŸš© FIX: runtimeOnly -> implementationìœ¼ë¡œ ë³€ê²½ (í´ë˜ìŠ¤ ë¡œë“œ ì˜¤ë¥˜ í•´ê²°)
    implementation 'org.mariadb.jdbc:mariadb-java-client'
    implementation 'org.springframework.boot:spring-boot-starter-data-mongodb' // ëª½ê³ ë””ë¹„ ì˜ì¡´ì„±

    // ----------------------------------------------------
    // Utility & Tooling
    // ----------------------------------------------------
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    testCompileOnly 'org.projectlombok:lombok'
    testAnnotationProcessor 'org.projectlombok:lombok'

    developmentOnly 'org.springframework.boot:spring-boot-devtools'

    implementation 'org.modelmapper:modelmapper:3.1.0'
    implementation 'com.google.code.gson:gson:2.11.0'
    implementation 'com.squareup.okhttp3:okhttp:4.11.0' // OkHttp dependency

    // ----------------------------------------------------
    //YYJ
    // External APIs - YouTube API v3
    // Maven Centralì—ì„œ í™•ì¸ëœ ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ë²„ì „ ì‚¬ìš©
    implementation 'com.google.apis:google-api-services-youtube:v3-rev20250714-2.0.0'
    implementation 'com.google.api-client:google-api-client:2.2.0'
    implementation 'com.google.http-client:google-http-client-jackson2:1.43.3'
    // ----------------------------------------------------

    // API ë¬¸ì„œí™” (SpringDoc) - ë²„ì „ êµì²´ ì ìš©
    implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.8.3'

    // Querydsl ì„¤ì •
    implementation "com.querydsl:querydsl-jpa:${queryDslVersion}:jakarta"
    annotationProcessor(
            "jakarta.persistence:jakarta.persistence-api",
            "jakarta.annotation:jakarta.annotation-api",
            "com.querydsl:querydsl-apt:${queryDslVersion}:jakarta"
    )

    // ----------------------------------------------------
    // Test
    // ----------------------------------------------------
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'


//    CKM ì¶”ê°€
//    ìœ íš¨ì„±ê²€ì‚¬ (ì•„ì´ë””ì— ì˜ì–´ ë° ìˆ«ìë§Œ ì‚¬ìš©ê°€ëŠ¥í•˜ê²Œ)
    implementation 'org.springframework.boot:spring-boot-starter-validation'


}

// ----------------------------------------------------
// Querydsl ë° ë¹Œë“œ ì„¤ì •
// ----------------------------------------------------

// Querydsl ìƒì„±ì„ ìœ„í•œ task ì„¤ì • ì¶”ê°€: Q-Class ìƒì„± ê²½ë¡œ ì§€ì •
tasks.withType(JavaCompile).configureEach {
    options.generatedSourceOutputDirectory.set(file(project.buildDir.path + "/generated"))
}

// í…ŒìŠ¤íŠ¸ ì„¤ì • ìœ ì§€
tasks.named('test') {
    useJUnitPlatform()
    ignoreFailures = true // ì´ì „ ì˜¤ë¥˜ ë°œìƒì„ ë§‰ê¸° ìœ„í•´ ìœ ì§€
}

// Querydsl ì†ŒìŠ¤ì…‹ ì„¤ì • ìœ ì§€: build/generated í´ë”ë¥¼ ì»´íŒŒì¼ ê²½ë¡œì— ì¶”ê°€
sourceSets {
    main {
        java {
            srcDirs = ["$projectDir/src/main/java", "$projectDir/build/generated"]
        }
    }
}

// ğŸ’¡ Querydsl ìƒì„± í´ë” ëª…ì‹œì  ì‚­ì œ ì¶”ê°€
clean {
    delete file(project.buildDir.path + "/generated")
}

// ì»´íŒŒì¼ ì‹œ clean ì‹¤í–‰ ì„¤ì • ìœ ì§€ (ì‚¬ìš©ì ìš”ì²­ì— ë”°ë¼ ìœ ì§€)
//compileJava.dependsOn('clean')
