# AIAnalysisService 클래스 설명

`AIAnalysisService`는 이 프로젝트의 핵심 비즈니스 로직을 처리하는 중앙 서비스(Orchestration Service)입니다.

클라이언트로부터 받은 이미지 파일을 AI 서버로 보내 분석 결과를 받고, 그 결과를 바탕으로 내부 데이터베이스와 외부 YouTube API를 조회하여 최종적인 통합 분석 결과를 만들어냅니다.

---

## 1. 주요 의존성 (Dependencies)

-   `OkHttpClient`, `Gson`: Flask AI 서버와 HTTP 통신 및 JSON 데이터 처리를 위해 사용합니다.
-   `FoodReferenceRepository`: AI가 분석한 음식 이름으로 MongoDB에 저장된 영양 정보를 조회하기 위해 사용합니다.
-   `YoutubeApiService`: 음식 이름으로 YouTube 레시피 영상을 검색하기 위해 사용합니다.
-   `ModelMapper`: `FoodReference` Entity를 `NutritionData` DTO로 변환하는 작업을 자동화하기 위해 사용합니다.

---

## 2. 핵심 메서드: `analyzeImage(MultipartFile imageFile)`

이 메서드는 아래와 같은 순서로 동작합니다.

1.  **AI 분석 요청 (Flask 연동):**
    -   클라이언트로부터 받은 `MultipartFile` 형태의 이미지 파일을 OkHttp를 사용하여 Flask AI 서버의 `/analyze` 엔드포인트로 전송합니다.
    -   AI 서버로부터 음식 이름(`foodName`), 정확도(`accuracy`) 등이 포함된 초기 분석 결과를 JSON 형태로 받습니다.
    -   통신 과정에서 오류가 발생하면, 오류 메시지를 담은 `FoodAnalysisResultDTO`를 반환하고 처리를 중단합니다.

2.  **영양 정보 조회 (DB 연동):**
    -   AI가 분석한 `foodName`을 키로 사용하여 `FoodReferenceRepository`를 통해 MongoDB에서 해당 음식의 영양 정보를 조회합니다.
    -   조회에 성공하면, `ModelMapper`를 이용해 `FoodReference` Entity를 `NutritionData` DTO로 변환합니다.
    -   결과가 없으면 영양 정보 부분은 비워둡니다.

3.  **레시피 검색 (외부 API 연동):**
    -   마찬가지로 `foodName`을 키로 사용하여 `YoutubeApiService`를 통해 YouTube에서 관련 레시피 영상 목록을 검색합니다.

4.  **최종 결과 조립 및 반환:**
    -   위 1, 2, 3단계에서 얻은 모든 정보(AI 분석 결과, 영양 정보, 유튜브 레시피 목록)를 `FoodAnalysisResultDTO`에 담아 최종적으로 반환합니다.